<nb-layout>
    <nb-layout-header fixed>
        <toaster-container [toasterconfig]="$toasterconfig"></toaster-container>
        <nb-actions>
            <nb-action icon="nb-email"></nb-action>
        </nb-actions>
    </nb-layout-header>
    <nb-layout-column>
        <div class="row">
            <div class="col-lg-3">
                <nb-card>
                    <chat-client-queue ($clientOpen)="$startClientChat($event)"></chat-client-queue>
                    <nb-card-footer></nb-card-footer>
                </nb-card>
            </div>
            <div class="col-lg-9" *ngIf="$discussions.length == 0">
                <nb-card>
                    <nb-card-header>
                        <span *ngIf="$connecting == 0" style="margin-left: 0.5rem;">Отсоединено</span>
                        <img *ngIf="$connecting == 1" style="width:1rem; height:1rem; float:left;" src="/assets/loading4.gif" />
                        <span *ngIf="$connecting == 1" style="margin-left: 0.5rem;">Соединяемся..</span>
                    </nb-card-header>
                    <nb-card-body>Выберите клиента в очереди. Тут появится чат</nb-card-body>
                </nb-card>
            </div>
            <div class="col-lg-9">
                <nb-card>
                    <nb-tabset>
                        <nb-tab *ngFor="let d of $discussions" [tabTitle]="d.clientID | atob" style="padding: 1.25rem;">
                            <ul class="chat-lines" id="{{d.clientID}}">
                                <li *ngFor="let ci of d.$history" [class.chat-line-fromop]="ci.opId" [class.noack]="ci.id == null || ci.id &lt; 0">
                                    <span *ngIf="!ci.opId" class="chat-line-avatar-op"></span>
                                    <div>
                                        <p>
                                            {{ci.text | capitalize }}
                                        </p>
                                        <span class="chat-line-time">{{ci.at | timeformat }}</span>
                                    </div>
                                </li>
                            </ul> 
                            <div class="form-group">
                                <textarea class="form-control" placeholder="Введите текст" rows="2" 
                                    (keydown.enter)="$onSendClick(d);false" [(ngModel)]="d.$text"></textarea>
                            </div>
                            <div class="form-group pushout">
                                <button class="btn btn-warning" type="submit" (click)='$release(d)'>Покинуть</button>
                                <button class="btn btn-primary" type="submit" (click)='$onSendClick(d)'>Отправить</button>
                            </div>
                        </nb-tab>
                    </nb-tabset>
                </nb-card>
            </div>
        </div>
    </nb-layout-column>
</nb-layout>